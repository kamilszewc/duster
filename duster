#!/bin/bash

if [ $# == 1 ]
then
    # Get config file path
    CONFIG_PATH=`pwd`/$1

    # Go to the directory of this script
    cd `dirname $0`

    # Launch sampler
    cd sampler;
    python3 sampler.py &
    SAMPLER=$!

    # Launch dusterapp
    cd ../dusterapp
    ./gradlew bootRun --args="--spring.config.location=$CONFIG_PATH" &
    WEBAPP=$!

    # Wait for any of the proceses to end/fail
    wait -n $SAMPLER $WEBAPP

    # Kill both processes
    kill -9 $SAMPLER && kill -9 $WEBAPP
else
    echo "Usage: ./duster path_to_config.yml"
fi

